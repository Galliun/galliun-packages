class GalliunClient{constructor(e={}){this.baseUrl=e.baseUrl||"http://localhost:5173",this.popupOrigin=new URL(this.baseUrl).origin,this.handleMessage=this.handleMessage.bind(this),window.addEventListener("message",this.handleMessage),this._activeFeatures=new Set}async createPayment(e){return{productId:e}}async getProduct(e){return{id:e}}elements={createButton:(e,t={})=>new GalliunButton(e,{...t,baseUrl:this.baseUrl,registerFeature:this.registerFeature.bind(this),unregisterFeature:this.unregisterFeature.bind(this)})};registerFeature(e){this._activeFeatures.add(e)}unregisterFeature(e){this._activeFeatures.delete(e)}handleMessage(e){e.origin===this.popupOrigin&&this._activeFeatures.forEach((t=>{"function"==typeof t.handleMessage&&t.handleMessage(e)}))}destroy(){window.removeEventListener("message",this.handleMessage),this._activeFeatures.forEach((e=>{"function"==typeof e.destroy&&e.destroy()})),this._activeFeatures.clear()}}class GalliunButton{constructor(e,t){this.elementId=e,this.baseUrl=t.baseUrl,this.registerFeature=t.registerFeature,this.unregisterFeature=t.unregisterFeature,this.popup=null,this.callbacks={}}mount(e={}){const t=document.getElementById(this.elementId);if(!t)return void console.error(`Element with id "${this.elementId}" not found`);if(this.callbacks={onSuccess:e.onSuccess,onError:e.onError,onClose:e.onClose,onLoaded:e.onLoaded},this.registerFeature(this),!e.productId)return void this.handleError({type:"validation_error",code:"parameter_missing",message:"Product ID is required",param:"productId"});this.productId=e.productId;const s=document.createElement("button");s.textContent=e.buttonText||"Pay with Galliun",Object.assign(s.style,{padding:"large"===e.buttonSize?"16px 24px":"small"===e.buttonSize?"8px 16px":"12px 20px",border:"none",borderRadius:"8px",cursor:"pointer",fontSize:"large"===e.buttonSize?"16px":"small"===e.buttonSize?"14px":"15px",fontWeight:"500",transition:"all 0.2s ease",width:"auto",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"8px"}),"dark"===e.buttonTheme?Object.assign(s.style,{background:"#1e293b",color:"#ffffff"}):Object.assign(s.style,{background:"#4f46e5",color:"#ffffff"}),e.customStyles&&Object.assign(s.style,e.customStyles),s.addEventListener("mouseover",(()=>{s.style.transform="translateY(-1px)",s.style.opacity="0.9"})),s.addEventListener("mouseout",(()=>{s.style.transform="translateY(0)",s.style.opacity="1"})),s.addEventListener("click",(()=>this.openPopup(e.productId))),t.innerHTML="",t.appendChild(s)}handleMessage(e){const{type:t,data:s}=e.data;switch(t){case"GALLIUN_LOADED":this.callbacks.onLoaded?.();break;case"GALLIUN_SUCCESS":if(this.callbacks.onSuccess){const e={id:s.transactionId,status:"succeeded",amount:s.amount,currency:s.coinType,created:s.timestamp,metadata:{productId:s.productId,billId:s.billId},product:s.product};this.callbacks.onSuccess(e)}this.popup&&this.popup.close();break;case"GALLIUN_ERROR":this.handleError(s);break;case"GALLIUN_CLOSE":this.popup&&this.popup.close(),this.callbacks.onClose?.()}}handleError(e){if(this.callbacks.onError){const t={type:e.type||"api_error",code:e.code,message:e.message||e.error,param:e.param,metadata:{productId:this.productId,timestamp:Date.now()}};this.callbacks.onError(t)}this.popup&&this.popup.close()}openPopup(e){this.popup&&!this.popup.closed&&this.popup.close();const t=["width=400","height=600",`left=${(window.innerWidth-400)/2}`,`top=${(window.innerHeight-600)/2}`,"resizable=yes","scrollbars=yes"].join(",");if(this.popup=window.open(`${this.baseUrl}/popup-payment?productId=${encodeURIComponent(e)}`,"GalliunPaymentPopup",t),!this.popup||this.popup.closed)return void this.handleError({type:"popup_error",code:"popup_blocked",message:"Payment popup was blocked. Please allow popups for this site."});const s=setInterval((()=>{this.popup&&!this.popup.closed||(clearInterval(s),this.callbacks.onClose?.())}),500)}destroy(){this.popup&&!this.popup.closed&&this.popup.close(),this.unregisterFeature(this)}}window.Galliun={createClient:e=>new GalliunClient(e)};